/**
 * Copyright 5AM Solutions Inc, ESAC, ScenPro & SAIC
 *
 * Distributed under the OSI-approved BSD 3-Clause License.
 * See https://github.com/NCIP/caintegrator/blob/master/LICENSE for details.
 */
package gov.nih.nci.caintegrator2.external.aim;

import static org.junit.Assert.assertEquals;
import edu.northwestern.radiology.aim.ImageAnnotation;

import org.junit.Test;

/**
 * 
 */
public class ImageAnnotationXMLParserTest {

    
    @Test
    public void testRetrieveImageAnnotationFromXMLString() {
        ImageAnnotation imageAnnotation = ImageAnnotationXMLParser.retrieveImageAnnotationFromXMLString("<ImageAnnotation aimVersion=\"TCGA\" codeMeaning=\"Brain tumor target lesion\" codeValue=\"TCGA_2010\" codingSchemeDesignator=\"VASARI\" dateTime=\"2010-05-18T14:51:51\" id=\"0\" name=\"TCGA-06-0132\" uniqueIdentifier=\"1.3.6.1.4.1.25403.1097781229962.4032.20100518025151.3\" xsi:schemaLocation=\"gme://caCORE.caCORE/3.2/edu.northwestern.radiology.AIM AIM_TCGA09302009_XML.xsd\" xmlns=\"gme://caCORE.caCORE/3.2/edu.northwestern.radiology.AIM\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"><calculationCollection><Calculation codeMeaning=\"Length\" codeValue=\"G-A22A\" codingSchemeDesignator=\"SRT\" description=\"Length\" id=\"0\" uid=\"1.3.6.1.4.1.25403.1097781229962.4032.20100518025151.1\"><referencedCalculationCollection/><calculationResultCollection><CalculationResult id=\"0\" numberOfDimensions=\"1\" type=\"Scalar\" unitOfMeasure=\"mm\"><dataCollection><Data id=\"0\" value=\"90.198742097795\"><coordinateCollection><Coordinate dimensionIndex=\"0\" id=\"0\" position=\"0\"/></coordinateCollection></Data></dataCollection><dimensionCollection><Dimension id=\"0\" index=\"0\" label=\"Value\" size=\"1\"/></dimensionCollection></CalculationResult></calculationResultCollection><referencedGeometricShapeCollection><ReferencedGeometricShape id=\"0\" referencedShapeIdentifier=\"0\"/></referencedGeometricShapeCollection></Calculation><Calculation codeMeaning=\"Length\" codeValue=\"G-A22A\" codingSchemeDesignator=\"SRT\" description=\"Length\" id=\"0\" uid=\"1.3.6.1.4.1.25403.1097781229962.4032.20100518025151.2\"><referencedCalculationCollection/><calculationResultCollection><CalculationResult id=\"0\" numberOfDimensions=\"1\" type=\"Scalar\" unitOfMeasure=\"mm\"><dataCollection><Data id=\"0\" value=\"60.5170235897321\"><coordinateCollection><Coordinate dimensionIndex=\"0\" id=\"0\" position=\"0\"/></coordinateCollection></Data></dataCollection><dimensionCollection><Dimension id=\"0\" index=\"0\" label=\"Value\" size=\"1\"/></dimensionCollection></CalculationResult></calculationResultCollection><referencedGeometricShapeCollection><ReferencedGeometricShape id=\"0\" referencedShapeIdentifier=\"1\"/></referencedGeometricShapeCollection></Calculation></calculationCollection><user><User id=\"0\" loginName=\"praghavan\" name=\"praghavan\" numberWithinRoleOfClinicalTrial=\"5\" roleInTrial=\"Performing\"/></user><equipment><Equipment id=\"0\" manufacturer=\"Northwestern University\" manufacturerModelName=\"AIM_TCGA_v2\" softwareVersion=\"AIM_TCGA09302009v2\"/></equipment><anatomicEntityCollection><AnatomicEntity codeMeaning=\"Temporal lobe\" codeValue=\"RID6476\" codingSchemeDesignator=\"RadLex\" id=\"0\"/><AnatomicEntity codeMeaning=\"Right\" codeValue=\"G-A100\" codingSchemeDesignator=\"SRT\" id=\"0\"/></anatomicEntityCollection><imagingObservationCollection><ImagingObservation codeMeaning=\"mass\" codeValue=\"RID3874\" codingSchemeDesignator=\"RadLex\" id=\"0\"><imagingObservationCharacteristicCollection><ImagingObservationCharacteristic codeMeaning=\"Enhancement Quality : Mark/Avid\" codeValue=\"69\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Proportion Enhancing : &lt; 5%\" codeValue=\"55\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Proportion nCET : 34-67%\" codeValue=\"22\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Proportion Necrosis : 6-33%\" codeValue=\"47\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Proportion of Edema : 34-67%\" codeValue=\"31\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Cysts No\" codeValue=\"36\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Focal\" codeValue=\"13\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Mixed T1&lt;FLAIR Ratio\" codeValue=\"91\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Thickness of the Enhancing Margin Thick/nodular (&gt;3mm)\" codeValue=\"82\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Definition of the Enhancing Margin Well-defined\" codeValue=\"11\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Definition of the Non-Enhancing Margin Indeterminate\" codeValue=\"722\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Hemorrhage Yes\" codeValue=\"106\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Diffusion : Mixed\" codeValue=\"113\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Pial Invasion No\" codeValue=\"115\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Ependymal Extension No\" codeValue=\"120\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Cortical involvement Yes\" codeValue=\"126\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Deep WM Invasion Internal Capsule\" codeValue=\"6\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"nCET Tumor Crosses Midline No\" codeValue=\"62\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Enhancing Tumor Crosses Midline No\" codeValue=\"2\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Satellites No\" codeValue=\"129\" codingSchemeDesignator=\"VASARI\" id=\"0\"/><ImagingObservationCharacteristic codeMeaning=\"Calvarial Remodeling No\" codeValue=\"135\" codingSchemeDesignator=\"VASARI\" id=\"0\"/></imagingObservationCharacteristicCollection></ImagingObservation></imagingObservationCollection><inferenceCollection><Inference codeMeaning=\"No Eloquent Brain\" codeValue=\"85\" codingSchemeDesignator=\"VASARI\" codingSchemeVersion=\"\" id=\"0\" truth=\"false\"/></inferenceCollection><imageReferenceCollection><ImageReference id=\"0\" xsi:type=\"DICOMImageReference\"><study><Study id=\"0\" instanceUID=\"1.3.6.1.4.1.9328.50.45.156068272915163991923280385588217079654\" studyDate=\"1891-04-11T00:00:00\" studyTime=\"000000\"><series><Series id=\"0\" instanceUID=\"1.3.6.1.4.1.9328.50.45.288861537619222119588401224045738055768\"><imageCollection><Image id=\"0\" sopClassUID=\"1.2.840.10008.5.1.4.1.1.4\" sopInstanceUID=\"1.3.6.1.4.1.9328.50.45.277983375086854441363125607879641395349\"/></imageCollection></Series></series></Study></study></ImageReference></imageReferenceCollection><patient><Patient birthDate=\"0001-01-01T00:00:00\" id=\"0\" name=\"141923\" patientID=\"TCGA-06-0132\"/></patient><geometricShapeCollection><GeometricShape id=\"0\" includeFlag=\"true\" shapeIdentifier=\"0\" xsi:type=\"MultiPoint\"><spatialCoordinateCollection><SpatialCoordinate coordinateIndex=\"0\" id=\"0\" imageReferenceUID=\"1.3.6.1.4.1.9328.50.45.277983375086854441363125607879641395349\" referencedFrameNumber=\"1\" x=\"92.9185104370117\" xsi:type=\"TwoDimensionSpatialCoordinate\" y=\"72.0592498779297\"/><SpatialCoordinate coordinateIndex=\"1\" id=\"0\" imageReferenceUID=\"1.3.6.1.4.1.9328.50.45.277983375086854441363125607879641395349\" referencedFrameNumber=\"1\" x=\"97.9753036499024\" xsi:type=\"TwoDimensionSpatialCoordinate\" y=\"168.138259887695\"/></spatialCoordinateCollection></GeometricShape><GeometricShape id=\"0\" includeFlag=\"true\" shapeIdentifier=\"1\" xsi:type=\"MultiPoint\"><spatialCoordinateCollection><SpatialCoordinate coordinateIndex=\"0\" id=\"0\" imageReferenceUID=\"1.3.6.1.4.1.9328.50.45.277983375086854441363125607879641395349\" referencedFrameNumber=\"1\" x=\"66.370361328125\" xsi:type=\"TwoDimensionSpatialCoordinate\" y=\"132.108627319336\"/><SpatialCoordinate coordinateIndex=\"1\" id=\"0\" imageReferenceUID=\"1.3.6.1.4.1.9328.50.45.277983375086854441363125607879641395349\" referencedFrameNumber=\"1\" x=\"130.844436645508\" xsi:type=\"TwoDimensionSpatialCoordinate\" y=\"128.948135375977\"/></spatialCoordinateCollection></GeometricShape></geometricShapeCollection></ImageAnnotation>");
        assertEquals(21, imageAnnotation.getImagingObservationCollection().getImagingObservation().length);
    }

}
