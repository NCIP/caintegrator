<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="gov.nih.nci.caintegrator2.domain.application">
    <typedef name="AnalysisJobStatusEnum" class="gov.nih.nci.caintegrator2.common.GenericEnumUserType"> 
       <param name="enumClass">gov.nih.nci.caintegrator2.domain.application.AnalysisJobStatusEnum</param> 
    </typedef> 
    <typedef name="AnalysisJobTypeEnum" class="gov.nih.nci.caintegrator2.common.GenericEnumUserType"> 
       <param name="enumClass">gov.nih.nci.caintegrator2.domain.application.AnalysisJobTypeEnum</param> 
    </typedef> 
	<class name="AbstractPersistedAnalysisJob" table="ABSTRACT_PERSISTED_ANALYSIS_JOB" lazy="false" polymorphism="explicit">
		<cache usage="read-write" />
		<id name="id" type="long" column="ID">
			<generator class="native" />
		</id>
		<!-- Attributes mapping for the AbstractPersistedJob class -->
		<discriminator column="TYPE" />
		<property name="name" type="string" column="NAME"/>
        <property name="status" type="AnalysisJobStatusEnum" column="STATUS"/>
        <property name="statusDescription" type="string" column="STATUS_DESCRIPTION"/>
        <property name="creationDate" type="java.util.Date" column="CREATION_DATE"/>
        <property name="lastUpdateDate" type="java.util.Date" column="LAST_UPDATE_DATE"/>

        <many-to-one name="subscription" class="gov.nih.nci.caintegrator2.domain.application.StudySubscription" column="STUDY_SUBSCRIPTION_ID" lazy="proxy" cascade="none" />

        <subclass name="GenePatternAnalysisJob" lazy="false" discriminator-value="Gene Pattern">
            <!-- Attributes mapping for the GenePatternAnalysisJob class -->
	        <property name="jobUrl" type="string" column="JOB_URL"/>
            <property name="gpJobNumber" type="integer" column="GP_JOB_NUMBER"/>
            <!-- Associations mapping for the AbstractPersistedJob class -->   
        </subclass>
        <subclass name="ComparativeMarkerSelectionAnalysisJob" lazy="false" discriminator-value="Comparative Marker Selection">
            <!-- Attributes mapping for the ComparativeMarkerSelectionAnalysisJob class -->
            <property name="preprocessDataSetUrl" type="string" column="PREPROCESS_GRID_URL"/>
            <property name="comparativeMarkerSelectionUrl" type="string" column="MAIN_GRID_URL"/>
            <!-- Associations mapping for the ComparativeMarkerSelectionAnalysisJob class -->
            <list name="results" lazy="true" cascade="save-update,merge" >
	            <cache usage="read-write" />
	            <key column="COMPARATIVE_MARKER_JOB_ID" />
	            <list-index column="MARKER_INDEX"/>
	            <one-to-many class="gov.nih.nci.caintegrator2.domain.analysis.MarkerResult"/>
            </list>
        </subclass>
        <subclass name="PrincipalComponentAnalysisJob" lazy="false" discriminator-value="Principal Component Analysis" >
            <!-- Attributes mapping for the PCAAnalysisJob class -->
            <component name="ResultsZipFile">
                <property name="path" column="RESULTS_ZIP_FILE_PATH" />
	        </component>
	        <property name="pcaUrl" type="string" column="MAIN_GRID_URL"/>
	        <property name="preprocessDataSetUrl" type="string" column="PREPROCESS_GRID_URL"/>
        </subclass>
        <subclass name="GisticAnalysisJob" lazy="false" discriminator-value="GISTIC">
            <!-- Attributes mapping for the GisticAnalysisJob class -->
            <property name="gisticUrl" type="string" column="MAIN_GRID_URL"/>
            <!-- Associations mapping for the GisticAnalysisJob class -->
            <list name="results" lazy="true" cascade="save-update,merge" >
                <cache usage="read-write" />
                <key column="GISTIC_JOB_ID" />
                <list-index column="GISTIC_INDEX"/>
                <one-to-many class="gov.nih.nci.caintegrator2.domain.analysis.GisticResult"/>
            </list>
        </subclass>
	</class>
</hibernate-mapping>